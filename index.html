<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ä½œæ¥­å·¥ç¨‹è¡¨ç¢ºèª</title>
<style>
    body { font-family: sans-serif; margin: 20px; background-color: #f0f0f0; }
    h1 { color: #333; text-align: center; }
    #reloadButton {
        display: block; margin: 0 auto 20px; padding: 10px 20px;
        background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;
    }
    .container { overflow-x: auto; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    table { border-collapse: collapse; width: 100%; table-layout: fixed; min-width: 1200px; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: center; font-size: 10pt; height: 35px; }
    
    /* å·¦ç«¯ï¼ˆæ‹…å½“è€…åï¼‰ã®å›ºå®š */
    .name-column { background-color: #e8e8e8; font-weight: bold; width: 120px; position: sticky; left: 0; z-index: 5; }
    /* æ™‚é–“ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .time-header { background-color: #444; color: white; width: 45px; font-size: 9pt; }
    /* ãƒãƒ¼ã®ä¸­ã®ãƒ†ã‚­ã‚¹ãƒˆ */
    .bar-text { font-size: 8pt; font-weight: bold; white-space: nowrap; overflow: hidden; }
</style>
</head>
<body>
    <h1 id="mainTitle">æœ¬æ—¥ã®ä½œæ¥­å·¥ç¨‹è¡¨</h1>
    <button id="reloadButton">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°</button>
    <div class="container" id="ganttContainer">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

<script>
    // ğŸŒŸ ã€é‡è¦ã€‘ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œå…¥åŠ›ã€ã‚·ãƒ¼ãƒˆã‚’CSVå…¬é–‹ã—ãŸURLã«æ›¸ãæ›ãˆã¦ãã ã•ã„
    const PUBLIC_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTpvVF_Vr1KaDNLsa03dZZrD_iMBLEw_l_4bJP3E_e223SADZYC2B_iOzNr2VCxkRCWKMVbu2iebL1Z/pub?gid=786246587&single=true&output=csv';

    // è¡¨ç¤ºè¨­å®šï¼ˆSSã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„ï¼‰
    const START_HOUR = 4;  // é–‹å§‹4:00
    const END_HOUR = 21;    // çµ‚äº†20:30 (21æ™‚ã¾ã§è¡¨ç¤º)
    const INTERVAL = 30;    // 30åˆ†åˆ»ã¿

    async function updateSchedule() {
        try {
            const res = await fetch(PUBLIC_CSV_URL);
            const csvText = await res.text();
            const rows = csvText.trim().split('\n').map(row => row.split(','));

            // B:æ¥­å‹™(1), C:æ‹…å½“(2), D:é–‹å§‹(3), E:çµ‚äº†(4), G:ã‚«ãƒ©ãƒ¼(6) ã‚’æŠ½å‡º
            // â€»CSVã¯0ã‹ã‚‰æ•°ãˆã‚‹ãŸã‚ã€Gåˆ—ã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹6ã«ãªã‚Šã¾ã™
            const tasks = rows.slice(1).map(r => ({
                job: r[1]?.trim(),
                staff: r[2]?.trim(),
                start: r[3]?.trim(),
                end: r[4]?.trim(),
                color: r[6]?.trim() || '#cccccc'
            })).filter(t => t.job && t.staff && t.start);

            renderChart(tasks);
        } catch (e) {
            document.getElementById('ganttContainer').innerHTML = 'ã‚¨ãƒ©ãƒ¼: ' + e.message;
        }
    }

    function renderChart(tasks) {
        // æ‹…å½“è€…ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã‚‹ï¼ˆå·¥ç¨‹è¡¨2ã®å½¢å¼ï¼‰
        let staffMap = {};
        tasks.forEach(t => {
            let names = t.staff.split(/[,ã€]/);
            names.forEach(n => {
                let name = n.trim();
                if (!staffMap[name]) staffMap[name] = [];
                staffMap[name].push(t);
            });
        });

        let html = '<table><thead><tr><th class="name-column">æ‹…å½“è€…</th>';
        // æ™‚é–“ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ
        for (let h = START_HOUR; h < END_HOUR; h++) {
            for (let m = 0; m < 60; m += INTERVAL) {
                let timeStr = `${h}:${m === 0 ? '00' : m}`;
                html += `<th class="time-header">${timeStr}</th>`;
            }
        }
        html += '</tr></thead><tbody>';

        // æ‹…å½“è€…ã”ã¨ã®è¡Œã‚’ä½œæˆ
        for (let staff in staffMap) {
            html += `<tr><td class="name-column">${staff}</td>`;
            
            for (let h = START_HOUR; h < END_HOUR; h++) {
                for (let m = 0; m < 60; m += INTERVAL) {
                    let currentTime = h * 60 + m;
                    
                    let task = staffMap[staff].find(t => {
                        let [sh, sm] = t.start.split(':').map(Number);
                        let [eh, em] = t.end.split(':').map(Number);
                        return currentTime >= (sh * 60 + sm) && currentTime < (eh * 60 + em);
                    });

                    if (task) {
                        let [sh, sm] = task.start.split(':').map(Number);
                        let isStart = currentTime === (sh * 60 + sm);
                        html += `<td style="background-color:${task.color};"><div class="bar-text">${isStart ? task.job : ''}</div></td>`;
                    } else {
                        html += '<td></td>';
                    }
                }
            }
            html += '</tr>';
        }
        html += '</tbody></table>';
        document.getElementById('ganttContainer').innerHTML = html;
    }

    window.onload = updateSchedule;
    document.getElementById('reloadButton').onclick = updateSchedule;
</script>
</body>
</html>
